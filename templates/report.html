<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Informe de Seguridad - {{ domain }}</title>
    <style>
        /* Variables CSS */
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --accent-color: #f59e0b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --critical-color: #dc2626;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --bg-accent: #f3f4f6;
            --border-color: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Reset y base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }

        /* Layout principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-primary);
            box-shadow: var(--shadow);
        }

        /* Portada */
        .cover-page {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 80px 40px;
            text-align: center;
            page-break-after: always;
        }

        .cover-page h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            letter-spacing: -0.025em;
        }

        .cover-page .subtitle {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cover-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .cover-info-item {
            text-align: center;
        }

        .cover-info-item .label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .cover-info-item .value {
            font-size: 1.25rem;
            font-weight: 600;
        }

        /* Navegaci√≥n */
        .nav-section {
            background: var(--bg-accent);
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .nav-item {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .nav-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .nav-item h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        /* Contenido principal */
        .main-content {
            padding: 2rem;
        }

        /* Secciones */
        .section {
            margin-bottom: 3rem;
            page-break-inside: avoid;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid var(--primary-color);
        }

        .section-icon {
            width: 2rem;
            height: 2rem;
            margin-right: 1rem;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .section h2 {
            font-size: 2rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .section h3 {
            font-size: 1.5rem;
            color: var(--text-primary);
            margin: 2rem 0 1rem 0;
            font-weight: 600;
        }

        /* Resumen ejecutivo */
        .executive-summary {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .risk-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1.125rem;
            margin: 1rem 0;
        }

        .risk-critical { background: #fef2f2; color: var(--critical-color); border: 2px solid var(--critical-color); }
        .risk-high { background: #fef2f2; color: var(--danger-color); border: 2px solid var(--danger-color); }
        .risk-medium { background: #fffbeb; color: var(--warning-color); border: 2px solid var(--warning-color); }
        .risk-low { background: #f0fdf4; color: var(--success-color); border: 2px solid var(--success-color); }

        /* M√©tricas clave */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .metric-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Tablas */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .data-table th {
            background: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tr:hover {
            background: var(--bg-accent);
        }

        /* Severidades */
        .severity {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .severity-critical { background: #fef2f2; color: var(--critical-color); }
        .severity-high { background: #fef2f2; color: var(--danger-color); }
        .severity-medium { background: #fffbeb; color: var(--warning-color); }
        .severity-low { background: #f0fdf4; color: var(--success-color); }
        .severity-info { background: #f0f9ff; color: var(--secondary-color); }

        /* Hallazgos */
        .finding-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s;
        }

        .finding-card:hover {
            box-shadow: var(--shadow);
        }

        .finding-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .finding-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .finding-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .finding-detail {
            display: flex;
            flex-direction: column;
        }

        .finding-detail .label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .finding-detail .value {
            font-weight: 500;
        }

        /* Recomendaciones */
        .recommendation-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--secondary-color);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0 8px 8px 0;
        }

        .recommendation-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .recommendation-content {
            display: grid;
            gap: 1rem;
        }

        .recommendation-section {
            background: var(--bg-primary);
            padding: 1rem;
            border-radius: 6px;
        }

        .recommendation-section h5 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        /* MITRE ATT&CK Heatmap */
        .mitre-heatmap {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: var(--shadow);
        }

        .mitre-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1px;
            background: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .mitre-tactic {
            background: var(--primary-color);
            color: white;
            padding: 0.75rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .mitre-technique {
            background: var(--bg-accent);
            padding: 0.5rem;
            text-align: center;
            font-size: 0.75rem;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mitre-technique.detected {
            background: var(--danger-color);
            color: white;
            font-weight: 600;
        }

        /* Footer */
        .footer {
            background: var(--primary-color);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h4 {
            margin-bottom: 1rem;
        }

        .footer-section a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
        }

        .footer-section a:hover {
            color: white;
        }

        /* Tecnolog√≠as */
        .tech-summary {
            background: var(--bg-accent);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .tech-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .tech-badge {
            background: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .vuln-summary {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .severity-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .severity-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            min-width: 80px;
            color: white;
            font-weight: bold;
        }
        
        .severity-stat.critical {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .severity-stat.high {
            background: linear-gradient(135deg, #fd7e14, #e55a00);
        }
        
        .severity-stat.medium {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        
        .severity-stat.low {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }
        
        .severity-stat.info {
            background: linear-gradient(135deg, #17a2b8, #138496);
        }
        
        .severity-stat .count {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .severity-stat .label {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .tag {
            display: inline-block;
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            margin: 2px;
        }
        
        .leak-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .leak-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            min-width: 100px;
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            font-weight: bold;
        }
        
        .leak-stat .count {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .leak-stat .label {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-align: center;
        }
        
        .breach-item {
            margin-bottom: 10px;
            padding: 8px;
            background: #f8f9fa;
            border-left: 3px solid #dc3545;
            border-radius: 4px;
        }
        
        .breach-item strong {
            color: #dc3545;
        }
        
        .breach-item small {
            color: #6c757d;
            font-style: italic;
        }
        
        .port-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }
        
        .port-category {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            min-width: 80px;
            color: white;
            font-weight: bold;
        }
        
        .port-category.critical {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        
        .port-category.high {
            background: linear-gradient(135deg, #fd7e14, #e55a00);
        }
        
        .port-category.medium {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        
        .port-category .count {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .port-category .label {
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-code {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .status-200 {
            background: #dc3545;
            color: white;
        }
        
        .status-301, .status-302 {
            background: #fd7e14;
            color: white;
        }
        
        .status-403 {
            background: #ffc107;
            color: #212529;
        }
        
        .status-404 {
            background: #6c757d;
            color: white;
        }

        /* Utilidades */
        .text-center { text-align: center; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-4 { margin-bottom: 2rem; }
        .mt-4 { margin-top: 2rem; }
        .p-4 { padding: 2rem; }

        /* Responsive */
        @media (max-width: 768px) {
            .cover-page h1 { font-size: 2.5rem; }
            .main-content { padding: 1rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .finding-details { grid-template-columns: 1fr; }
        }

        /* Print styles */
        @media print {
            .nav-section { display: none; }
            .section { page-break-inside: avoid; }
            .cover-page { page-break-after: always; }
        }
    </style>
</head>
<body>
    <!-- Portada -->
    <div class="cover-page">
        <h1>Informe de Seguridad</h1>
        <div class="subtitle">An√°lisis Integral de Ciberseguridad</div>
        <div class="cover-info">
            <div class="cover-info-item">
                <div class="label">Dominio Objetivo</div>
                <div class="value">{{ domain }}</div>
            </div>
            <div class="cover-info-item">
                <div class="label">Fecha del An√°lisis</div>
                <div class="value">{{ date }}</div>
            </div>
            <div class="cover-info-item">
                <div class="label">Nivel de Riesgo</div>
                <div class="value">{{ risk_level }}</div>
            </div>
            <div class="cover-info-item">
                <div class="label">Puntuaci√≥n de Riesgo</div>
                <div class="value">{{ risk_score }}/100</div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Navegaci√≥n -->
        <div class="nav-section">
            <h2 class="text-center mb-4">√çndice del Informe</h2>
            <div class="nav-grid">
                <a href="#resumen-ejecutivo" class="nav-item">
                    <h3>üìä Resumen Ejecutivo</h3>
                    <p>Visi√≥n general del estado de seguridad y riesgos principales</p>
                </a>
                <a href="#metricas-clave" class="nav-item">
                    <h3>üìà M√©tricas Clave</h3>
                    <p>Indicadores principales y estad√≠sticas del an√°lisis</p>
                </a>
                <a href="#hallazgos-tecnicos" class="nav-item">
                    <h3>üîç Hallazgos T√©cnicos</h3>
                    <p>Detalles t√©cnicos de vulnerabilidades y exposiciones</p>
                </a>
                <a href="#recomendaciones" class="nav-item">
                    <h3>üí° Recomendaciones</h3>
                    <p>Acciones prioritarias para mejorar la seguridad</p>
                </a>
                <a href="#metodologia" class="nav-item">
                    <h3>‚öôÔ∏è Metodolog√≠a</h3>
                    <p>Herramientas y procesos utilizados en el an√°lisis</p>
                </a>
                <a href="#mitre-attack" class="nav-item">
                    <h3>üéØ MITRE ATT&CK</h3>
                    <p>Mapeo de t√©cnicas de ataque identificadas</p>
                </a>
            </div>
        </div>

        <div class="main-content">
            <!-- Resumen Ejecutivo -->
            <div class="section" id="resumen-ejecutivo">
                <div class="section-header">
                    <div class="section-icon">üìä</div>
                    <h2>Resumen Ejecutivo</h2>
                </div>
                
                <div class="executive-summary">
                    <h3>Estado General de Seguridad</h3>
                    <p>{{ executive_summary_text }}</p>
                    
                    <div class="text-center mt-4">
                        <div class="risk-indicator risk-{{ risk_level.lower() }}">
                            üö® Nivel de Riesgo: {{ risk_level }} ({{ risk_score }}/100)
                        </div>
                    </div>
                </div>

                <h3>Hallazgos Principales</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">{{ nuclei_critical_high_count }}</div>
                        <div class="metric-label">Vulnerabilidades Cr√≠ticas/Altas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ nmap_open_ports_count }}</div>
                        <div class="metric-label">Puertos Abiertos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ leaks_count }}</div>
                        <div class="metric-label">Credenciales Comprometidas</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ cves_count }}</div>
                        <div class="metric-label">CVEs Identificados</div>
                    </div>
                </div>
            </div>

            <!-- M√©tricas Clave -->
            <div class="section" id="metricas-clave">
                <div class="section-header">
                    <div class="section-icon">üìà</div>
                    <h2>M√©tricas Clave del An√°lisis</h2>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">{{ subdomains_count }}</div>
                        <div class="metric-label">Subdominios Descubiertos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ httpx_count }}</div>
                        <div class="metric-label">Hosts Activos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ typosquats_count }}</div>
                        <div class="metric-label">Dominios Typosquatting</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ security_config_count }}</div>
                        <div class="metric-label">Configuraciones Inseguras</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">{{ dir_brute_count }}</div>
                        <div class="metric-label">Directorios Expuestos</div>
                    </div>
                </div>

                <h3>Distribuci√≥n de Vulnerabilidades por Severidad</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Severidad</th>
                            <th>Cantidad</th>
                            <th>Porcentaje</th>
                            <th>Prioridad de Remediaci√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="severity severity-critical">Cr√≠tica</span></td>
                            <td>{{ nuclei_severity_counts.critical }}</td>
                            <td>{% if nuclei_severity_counts.critical > 0 %}{{ "%.1f"|format((nuclei_severity_counts.critical / (nuclei_severity_counts.critical + nuclei_severity_counts.high + nuclei_severity_counts.medium + nuclei_severity_counts.low + nuclei_severity_counts.info)) * 100) }}%{% else %}0%{% endif %}</td>
                            <td>Inmediata (0-24h)</td>
                        </tr>
                        <tr>
                            <td><span class="severity severity-high">Alta</span></td>
                            <td>{{ nuclei_severity_counts.high }}</td>
                            <td>{% if nuclei_severity_counts.high > 0 %}{{ "%.1f"|format((nuclei_severity_counts.high / (nuclei_severity_counts.critical + nuclei_severity_counts.high + nuclei_severity_counts.medium + nuclei_severity_counts.low + nuclei_severity_counts.info)) * 100) }}%{% else %}0%{% endif %}</td>
                            <td>Urgente (1-7 d√≠as)</td>
                        </tr>
                        <tr>
                            <td><span class="severity severity-medium">Media</span></td>
                            <td>{{ nuclei_severity_counts.medium }}</td>
                            <td>{% if nuclei_severity_counts.medium > 0 %}{{ "%.1f"|format((nuclei_severity_counts.medium / (nuclei_severity_counts.critical + nuclei_severity_counts.high + nuclei_severity_counts.medium + nuclei_severity_counts.low + nuclei_severity_counts.info)) * 100) }}%{% else %}0%{% endif %}</td>
                            <td>Moderada (1-4 semanas)</td>
                        </tr>
                        <tr>
                            <td><span class="severity severity-low">Baja</span></td>
                            <td>{{ nuclei_severity_counts.low }}</td>
                            <td>{% if nuclei_severity_counts.low > 0 %}{{ "%.1f"|format((nuclei_severity_counts.low / (nuclei_severity_counts.critical + nuclei_severity_counts.high + nuclei_severity_counts.medium + nuclei_severity_counts.low + nuclei_severity_counts.info)) * 100) }}%{% else %}0%{% endif %}</td>
                            <td>Planificada (1-3 meses)</td>
                        </tr>
                        <tr>
                            <td><span class="severity severity-info">Informacional</span></td>
                            <td>{{ nuclei_severity_counts.info }}</td>
                            <td>{% if nuclei_severity_counts.info > 0 %}{{ "%.1f"|format((nuclei_severity_counts.info / (nuclei_severity_counts.critical + nuclei_severity_counts.high + nuclei_severity_counts.medium + nuclei_severity_counts.low + nuclei_severity_counts.info)) * 100) }}%{% else %}0%{% endif %}</td>
                            <td>Opcional</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- MITRE ATT&CK -->
            <div class="section" id="mitre-attack">
                <div class="section-header">
                    <div class="section-icon">üéØ</div>
                    <h2>Mapeo MITRE ATT&CK</h2>
                </div>
                
                <p>El siguiente mapa de calor muestra las t√©cnicas de ataque MITRE ATT&CK identificadas durante el an√°lisis:</p>
                
                <div class="mitre-heatmap">
                    <div class="mitre-grid">
                        {% for tactic in mitre_tactics %}
                            <div class="mitre-tactic">{{ tactic }}</div>
                        {% endfor %}
                        
                        {% for tactic in mitre_tactics %}
                            <div>
                                {% for technique_id, detected in mitre_heatmap_data[tactic].items() %}
                                    <div class="mitre-technique {% if detected %}detected{% endif %}">
                                        {{ technique_id }}
                                    </div>
                                {% endfor %}
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <!-- Hallazgos T√©cnicos -->
            <div class="section" id="hallazgos-tecnicos">
                <div class="section-header">
                    <div class="section-icon">üîç</div>
                    <h2>Hallazgos T√©cnicos Detallados</h2>
                </div>

                <!-- Vulnerabilidades Nuclei -->
                <h3>üö® Vulnerabilidades de Aplicaciones Web</h3>
                {% if nuclei_data %}
                    <!-- Resumen por severidad -->
                    <div class="vuln-summary">
                        <h4>üìä Resumen de Vulnerabilidades por Severidad</h4>
                        <div class="severity-stats">
                            <div class="severity-stat critical">
                                <span class="count">{{ nuclei_severity_counts.critical }}</span>
                                <span class="label">Cr√≠ticas</span>
                            </div>
                            <div class="severity-stat high">
                                <span class="count">{{ nuclei_severity_counts.high }}</span>
                                <span class="label">Altas</span>
                            </div>
                            <div class="severity-stat medium">
                                <span class="count">{{ nuclei_severity_counts.medium }}</span>
                                <span class="label">Medias</span>
                            </div>
                            <div class="severity-stat low">
                                <span class="count">{{ nuclei_severity_counts.low }}</span>
                                <span class="label">Bajas</span>
                            </div>
                            <div class="severity-stat info">
                                <span class="count">{{ nuclei_severity_counts.info }}</span>
                                <span class="label">Info</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de vulnerabilidades -->
                    <h4>üîç Detalles de Vulnerabilidades</h4>
                    {% for finding in nuclei_data %}
                        <div class="finding-card">
                            <div class="finding-header">
                                <div class="finding-title">{{ finding.info.name or finding.template_id or 'Vulnerabilidad detectada' }}</div>
                                <span class="severity severity-{{ finding.info.severity.lower() }}">{{ finding.info.severity }}</span>
                            </div>
                            <div class="finding-details">
                                <div class="finding-detail">
                                    <div class="label">Host Afectado</div>
                                    <div class="value">{{ finding.host or finding.matched_at or 'No especificado' }}</div>
                                </div>
                                {% if finding.info.description %}
                                <div class="finding-detail">
                                    <div class="label">Descripci√≥n</div>
                                    <div class="value">{{ finding.info.description }}</div>
                                </div>
                                {% endif %}
                                {% if finding.info.tags %}
                                <div class="finding-detail">
                                    <div class="label">Categor√≠as</div>
                                    <div class="value">
                                        {% for tag in finding.info.tags %}
                                            <span class="tag">{{ tag }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                {% if finding.info.reference %}
                                <div class="finding-detail">
                                    <div class="label">Referencias</div>
                                    <div class="value">
                                        {% if finding.info.reference is string %}
                                            <a href="{{ finding.info.reference }}" target="_blank">{{ finding.info.reference }}</a>
                                        {% elif finding.info.reference is iterable %}
                                            {% for ref in finding.info.reference %}
                                                <a href="{{ ref }}" target="_blank">{{ ref }}</a><br>
                                            {% endfor %}
                                        {% else %}
                                            {{ finding.info.reference }}
                                        {% endif %}
                                    </div>
                                </div>
                                {% endif %}
                                {% if finding.extracted_results %}
                                <div class="finding-detail">
                                    <div class="label">Evidencia</div>
                                    <div class="value">{{ finding.extracted_results | join(', ') }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>‚úÖ No se identificaron vulnerabilidades significativas en aplicaciones web.</p>
                {% endif %}

                <!-- Puertos y Servicios -->
                <h3>üåê Puertos y Servicios Expuestos</h3>
                {% if nmap_data %}
                    <!-- Resumen de puertos por categor√≠a -->
                    <div class="vuln-summary">
                        <h4>üìä Resumen de Puertos por Categor√≠a de Riesgo</h4>
                        <div class="severity-stats">
                            <div class="severity-stat critical">
                                <span class="count">{{ nmap_data | selectattr('port', 'in', [21, 23, 135, 139, 445, 1433, 3389]) | list | length }}</span>
                                <span class="label">Cr√≠ticos</span>
                            </div>
                            <div class="severity-stat high">
                                <span class="count">{{ nmap_data | selectattr('port', 'in', [22, 25, 53, 80, 110, 143, 443, 993, 995, 3306, 5432]) | list | length }}</span>
                                <span class="label">Altos</span>
                            </div>
                            <div class="severity-stat medium">
                                <span class="count">{{ nmap_data | length - (nmap_data | selectattr('port', 'in', [21, 22, 23, 25, 53, 80, 110, 135, 139, 143, 443, 445, 993, 995, 1433, 3306, 3389, 5432]) | list | length) }}</span>
                                <span class="label">Otros</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de puertos -->
                    <h4>üîç Detalles de Puertos y Servicios</h4>
                    {% for item in nmap_data %}
                        {% set risk_level = 'critical' if item.port in [21, 23, 135, 139, 445, 1433, 3389] else ('high' if item.port in [22, 25, 53, 80, 110, 143, 443, 993, 995, 3306, 5432] else 'medium') %}
                        {% set risk_label = 'Cr√≠tico' if risk_level == 'critical' else ('Alto' if risk_level == 'high' else 'Medio') %}
                        <div class="finding-card">
                            <div class="finding-header">
                                <div class="finding-title">
                                    Puerto {{ item.port }}/{{ item.protocol }}
                                    {% if item.service %}
                                        - {{ item.service | title }}
                                    {% endif %}
                                    ({{ item.host }})
                                </div>
                                <span class="severity severity-{{ risk_level }}">{{ risk_label }}</span>
                            </div>
                            <div class="finding-details">
                                <div class="finding-detail">
                                    <div class="label">Estado</div>
                                    <div class="value">
                                        <span class="severity {% if item.state == 'open' %}severity-medium{% else %}severity-low{% endif %}">{{ item.state | title }}</span>
                                    </div>
                                </div>
                                {% if item.service %}
                                <div class="finding-detail">
                                    <div class="label">Servicio</div>
                                    <div class="value">{{ item.service | title }}</div>
                                </div>
                                {% endif %}
                                {% if item.product or item.version or item.extrainfo %}
                                <div class="finding-detail">
                                    <div class="label">Versi√≥n/Producto</div>
                                    <div class="value">{{ item.product }} {{ item.version }} {{ item.extrainfo }}</div>
                                </div>
                                {% endif %}
                                <div class="finding-detail">
                                    <div class="label">Recomendaci√≥n</div>
                                    <div class="value">
                                        {% if item.port == 21 %}
                                            Considerar deshabilitar FTP o usar SFTP/FTPS
                                        {% elif item.port == 22 %}
                                            Verificar configuraci√≥n SSH y usar autenticaci√≥n por clave
                                        {% elif item.port == 23 %}
                                            Deshabilitar Telnet inmediatamente, usar SSH
                                        {% elif item.port == 25 %}
                                            Verificar configuraci√≥n SMTP y filtros anti-spam
                                        {% elif item.port == 80 %}
                                            Considerar redirecci√≥n a HTTPS
                                        {% elif item.port == 443 %}
                                            Verificar certificados SSL/TLS y configuraci√≥n
                                        {% elif item.port == 3389 %}
                                            Restringir acceso RDP y usar VPN
                                        {% elif item.port in [135, 139, 445] %}
                                            Deshabilitar servicios SMB/NetBIOS si no son necesarios
                                        {% elif item.port in [1433, 3306, 5432] %}
                                            Restringir acceso a base de datos y usar firewall
                                        {% else %}
                                            Verificar si este servicio es necesario y est√° correctamente configurado
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>‚úÖ No se identificaron puertos abiertos o servicios expuestos relevantes.</p>
                {% endif %}

                <!-- Credenciales Comprometidas -->
                <h3>üîê Credenciales Comprometidas</h3>
                {% if leaks_data %}
                    <!-- Resumen de credenciales -->
                    <div class="vuln-summary">
                        <h4>üìä Resumen de Credenciales Comprometidas</h4>
                        <div class="severity-stats">
                            <div class="severity-stat critical">
                                <span class="count">{{ leaks_data | length }}</span>
                                <span class="label">Emails Comprometidos</span>
                            </div>
                            <div class="severity-stat high">
                                <span class="count">{{ leaks_data | sum(attribute='count') }}</span>
                                <span class="label">Total Brechas</span>
                            </div>
                            <div class="severity-stat medium">
                                <span class="count">{{ leaks_data | map(attribute='breaches') | map('length') | max | default(0) }}</span>
                                <span class="label">M√°x. por Email</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de credenciales -->
                    <h4>üîç Detalles de Credenciales Comprometidas</h4>
                    {% for leak in leaks_data %}
                        <div class="finding-card">
                            <div class="finding-header">
                                <div class="finding-title">{{ leak.email }}</div>
                                <span class="severity severity-critical">{{ leak.count }} brechas</span>
                            </div>
                            <div class="finding-details">
                                <div class="finding-detail">
                                    <div class="label">Brechas Identificadas</div>
                                    <div class="value">
                                        {% for breach in leak.breaches %}
                                            <div class="breach-item">
                                                <strong>{{ breach.Name }}</strong>
                                                {% if breach.Domain %} ({{ breach.Domain }}){% endif %}
                                                {% if breach.BreachDate %} - {{ breach.BreachDate }}{% endif %}
                                                {% if breach.DataClasses %}
                                                    <br><small>Datos comprometidos: {{ breach.DataClasses | join(', ') }}</small>
                                                {% endif %}
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="finding-detail">
                                    <div class="label">Recomendaci√≥n Urgente</div>
                                    <div class="value">
                                        <strong>üö® Acci√≥n Inmediata Requerida:</strong><br>
                                        ‚Ä¢ Cambiar contrase√±a inmediatamente<br>
                                        ‚Ä¢ Habilitar autenticaci√≥n de dos factores (2FA)<br>
                                        ‚Ä¢ Revisar actividad reciente en todas las cuentas<br>
                                        ‚Ä¢ Notificar al usuario sobre la brecha de seguridad<br>
                                        ‚Ä¢ Considerar monitoreo continuo de credenciales
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>‚úÖ No se encontraron credenciales comprometidas en brechas conocidas.</p>
                {% endif %}

                <!-- CVEs y Tecnolog√≠as -->
                <h3>üõ°Ô∏è Vulnerabilidades CVE y Tecnolog√≠as Detectadas</h3>
                {% if cves_data %}
                    <!-- Resumen de Tecnolog√≠as Detectadas -->
                    <div class="tech-summary">
                        <h4>üîß Tecnolog√≠as Identificadas</h4>
                        <div class="tech-grid">
                            {% set technologies = [] %}
                            {% for cve in cves_data %}
                                {% set tech = cve.affected_technology or cve.technology or 'Tecnolog√≠a no especificada' %}
                                {% if tech not in technologies %}
                                    {% set _ = technologies.append(tech) %}
                                {% endif %}
                            {% endfor %}
                            {% for tech in technologies %}
                                <div class="tech-badge">{{ tech }}</div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Detalles de CVEs -->
                    <h4>üìã Detalles de Vulnerabilidades CVE</h4>
                    {% for cve in cves_data %}
                        <div class="finding-card">
                            <div class="finding-header">
                                <div class="finding-title">{{ cve.cve_id or cve.id or 'CVE-ID no disponible' }}</div>
                                {% if cve.severity %}<span class="severity severity-{{ cve.severity.lower() }}">{{ cve.severity }}</span>{% endif %}
                            </div>
                            <div class="finding-details">
                                <div class="finding-detail">
                                    <div class="label">Tecnolog√≠a Afectada</div>
                                    <div class="value">{{ cve.affected_technology or cve.technology or 'No especificada' }}</div>
                                </div>
                                <div class="finding-detail">
                                    <div class="label">Descripci√≥n</div>
                                    <div class="value">{{ cve.description | default('No disponible') }}</div>
                                </div>
                                {% if cve.cvss_score %}
                                <div class="finding-detail">
                                    <div class="label">Puntuaci√≥n CVSS</div>
                                    <div class="value">{{ cve.cvss_score }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>‚úÖ No se identificaron CVEs relevantes para las tecnolog√≠as detectadas.</p>
                {% endif %}

                <!-- Typosquatting -->
                <h3>üé≠ Dominios Typosquatting</h3>
                {% if typosquats_data %}
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Dominio Similar</th>
                                <th>Distancia Levenshtein</th>
                                <th>Riesgo</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for typo in typosquats_data %}
                                <tr>
                                    <td>{{ typo.domain }}</td>
                                    <td>{{ typo.distance }}</td>
                                    <td><span class="severity {% if typo.distance <= 2 %}severity-high{% elif typo.distance <= 4 %}severity-medium{% else %}severity-low{% endif %}">{% if typo.distance <= 2 %}Alto{% elif typo.distance <= 4 %}Medio{% else %}Bajo{% endif %}</span></td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>‚úÖ No se identificaron dominios de typosquatting relevantes.</p>
                {% endif %}

                <!-- Configuraci√≥n de Seguridad -->
                <h3>‚öôÔ∏è Configuraciones de Seguridad</h3>
                {% if security_config_data %}
                    {% for finding in security_config_data %}
                        <div class="finding-card">
                            <div class="finding-header">
                                <div class="finding-title">{{ finding.type or finding.name or 'Configuraci√≥n de seguridad' }}</div>
                                {% if finding.severity %}<span class="severity severity-{{ finding.severity.lower() }}">{{ finding.severity }}</span>{% endif %}
                            </div>
                            <div class="finding-details">
                                <div class="finding-detail">
                                    <div class="label">Descripci√≥n</div>
                                    <div class="value">{{ finding.description or finding.details or 'No disponible' }}</div>
                                </div>
                                {% if finding.recommendation %}
                                <div class="finding-detail">
                                    <div class="label">Recomendaci√≥n</div>
                                    <div class="value">{{ finding.recommendation }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>‚úÖ No se identificaron configuraciones de seguridad problem√°ticas.</p>
                {% endif %}

                <!-- Directorios Expuestos -->
                <h3>üìÅ Directorios y Archivos Expuestos</h3>
                {% if dir_brute_data %}
                    <!-- Resumen de directorios -->
                    <div class="vuln-summary">
                        <h4>üìä Resumen de Directorios Expuestos</h4>
                        <div class="severity-stats">
                            <div class="severity-stat critical">
                                <span class="count">{{ dir_brute_data | selectattr('status', 'equalto', 200) | list | length }}</span>
                                <span class="label">Accesibles (200)</span>
                            </div>
                            <div class="severity-stat high">
                                <span class="count">{{ dir_brute_data | selectattr('status', 'in', [301, 302, 403]) | list | length }}</span>
                                <span class="label">Redirecciones/Prohibidos</span>
                            </div>
                            <div class="severity-stat medium">
                                <span class="count">{{ dir_brute_data | length }}</span>
                                <span class="label">Total Encontrados</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detalles de directorios -->
                    <h4>üîç Detalles de Directorios y Archivos</h4>
                    {% for finding in dir_brute_data %}
                        {% set risk_level = 'critical' if finding.status == 200 else ('high' if finding.status in [301, 302, 403] else 'medium') %}
                        {% set risk_label = 'Cr√≠tico' if risk_level == 'critical' else ('Alto' if risk_level == 'high' else 'Medio') %}
                        <div class="finding-card">
                            <div class="finding-header">
                                <div class="finding-title">
                                    {{ finding.url | replace('http://', '') | replace('https://', '') }}
                                </div>
                                <span class="severity severity-{{ risk_level }}">{{ risk_label }}</span>
                            </div>
                            <div class="finding-details">
                                <div class="finding-detail">
                                    <div class="label">URL Completa</div>
                                    <div class="value"><a href="{{ finding.url }}" target="_blank">{{ finding.url }}</a></div>
                                </div>
                                <div class="finding-detail">
                                    <div class="label">C√≥digo de Estado</div>
                                    <div class="value">
                                        <span class="status-code status-{{ finding.status }}">{{ finding.status }}</span>
                                        {% if finding.status == 200 %}
                                            - Accesible
                                        {% elif finding.status == 301 %}
                                            - Redirecci√≥n Permanente
                                        {% elif finding.status == 302 %}
                                            - Redirecci√≥n Temporal
                                        {% elif finding.status == 403 %}
                                            - Prohibido
                                        {% elif finding.status == 404 %}
                                            - No Encontrado
                                        {% endif %}
                                    </div>
                                </div>
                                {% if finding.length %}
                                <div class="finding-detail">
                                    <div class="label">Tama√±o de Respuesta</div>
                                    <div class="value">{{ finding.length }} bytes</div>
                                </div>
                                {% endif %}
                                {% if finding.words %}
                                <div class="finding-detail">
                                    <div class="label">Palabras</div>
                                    <div class="value">{{ finding.words }}</div>
                                </div>
                                {% endif %}
                                {% if finding.lines %}
                                <div class="finding-detail">
                                    <div class="label">L√≠neas</div>
                                    <div class="value">{{ finding.lines }}</div>
                                </div>
                                {% endif %}
                                <div class="finding-detail">
                                    <div class="label">Recomendaci√≥n</div>
                                    <div class="value">
                                        {% if finding.status == 200 %}
                                            <strong>üö® Revisar inmediatamente:</strong> Este directorio/archivo es accesible p√∫blicamente. Verificar si contiene informaci√≥n sensible y restringir acceso si es necesario.
                                        {% elif finding.status == 403 %}
                                            <strong>‚ö†Ô∏è Monitorear:</strong> Aunque est√° prohibido, la existencia del directorio es visible. Considerar ocultar completamente.
                                        {% elif finding.status in [301, 302] %}
                                            <strong>üìã Verificar:</strong> Revisar la redirecci√≥n para asegurar que no expone informaci√≥n no deseada.
                                        {% else %}
                                            <strong>‚ÑπÔ∏è Informativo:</strong> Directorio detectado pero no accesible directamente.
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>‚úÖ No se identificaron directorios o archivos expuestos relevantes.</p>
                {% endif %}
            </div>

            <!-- Recomendaciones -->
            <div class="section" id="recomendaciones">
                <div class="section-header">
                    <div class="section-icon">üí°</div>
                    <h2>Recomendaciones Estrat√©gicas</h2>
                </div>

                {% if recommendations %}
                    {% for rec in recommendations %}
                        <div class="recommendation-card">
                            <h4 class="recommendation-title">{{ rec.title }}</h4>
                            <div class="recommendation-content">
                                <div class="recommendation-section">
                                    <h5>üìã Descripci√≥n del Problema</h5>
                                    <p>{{ rec.description }}</p>
                                </div>
                                <div class="recommendation-section">
                                    <h5>üîß Soluci√≥n Recomendada</h5>
                                    <p>{{ rec.solution }}</p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <div class="recommendation-card">
                        <h4 class="recommendation-title">‚úÖ Estado de Seguridad √ìptimo</h4>
                        <div class="recommendation-content">
                            <div class="recommendation-section">
                                <p>No se identificaron vulnerabilidades cr√≠ticas que requieran atenci√≥n inmediata. Se recomienda mantener las buenas pr√°cticas de seguridad actuales y realizar an√°lisis peri√≥dicos.</p>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Metodolog√≠a -->
            <div class="section" id="metodologia">
                <div class="section-header">
                    <div class="section-icon">‚öôÔ∏è</div>
                    <h2>Metodolog√≠a y Herramientas</h2>
                </div>

                <h3>üîç Proceso de An√°lisis</h3>
                <p>El an√°lisis de seguridad se realiz√≥ siguiendo una metodolog√≠a estructurada que abarca m√∫ltiples vectores de ataque y t√©cnicas de reconocimiento:</p>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">üåê</div>
                        <div class="metric-label">Reconocimiento<br>Subdominios y hosts activos</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">üîç</div>
                        <div class="metric-label">Escaneo de Vulnerabilidades<br>Nuclei, CVEs, configuraciones</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">üõ°Ô∏è</div>
                        <div class="metric-label">An√°lisis de Exposici√≥n<br>Puertos, servicios, directorios</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">üìä</div>
                        <div class="metric-label">Inteligencia de Amenazas<br>HIBP, typosquatting, MITRE</div>
                    </div>
                </div>

                <h3>üõ†Ô∏è Herramientas Utilizadas</h3>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Herramienta</th>
                            <th>Prop√≥sito</th>
                            <th>Cobertura</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Amass</strong></td>
                            <td>Descubrimiento de subdominios</td>
                            <td>OSINT, DNS, certificados</td>
                        </tr>
                        <tr>
                            <td><strong>httpx</strong></td>
                            <td>Identificaci√≥n de hosts activos</td>
                            <td>HTTP/HTTPS, tecnolog√≠as</td>
                        </tr>
                        <tr>
                            <td><strong>Nuclei</strong></td>
                            <td>Escaneo de vulnerabilidades</td>
                            <td>CVEs, configuraciones, exposiciones</td>
                        </tr>
                        <tr>
                            <td><strong>Nmap</strong></td>
                            <td>Escaneo de puertos y servicios</td>
                            <td>TCP/UDP, detecci√≥n de servicios</td>
                        </tr>
                        <tr>
                            <td><strong>Have I Been Pwned</strong></td>
                            <td>Verificaci√≥n de credenciales comprometidas</td>
                            <td>Brechas de datos conocidas</td>
                        </tr>
                        <tr>
                            <td><strong>dnstwist</strong></td>
                            <td>Detecci√≥n de typosquatting</td>
                            <td>Dominios similares y variaciones</td>
                        </tr>
                    </tbody>
                </table>

                <h3>üìã Limitaciones del An√°lisis</h3>
                <div class="recommendation-card">
                    <div class="recommendation-content">
                        <div class="recommendation-section">
                            <h5>‚ö†Ô∏è Consideraciones Importantes</h5>
                            <ul>
                                <li>Este an√°lisis representa una instant√°nea en el tiempo y la superficie de ataque puede cambiar</li>
                                <li>Algunas vulnerabilidades pueden requerir autenticaci√≥n o contexto espec√≠fico para ser detectadas</li>
                                <li>Los resultados se basan en fuentes p√∫blicas y herramientas automatizadas</li>
                                <li>Se recomienda realizar an√°lisis manuales adicionales para una cobertura completa</li>
                                <li>Las pruebas se realizaron de forma no intrusiva para evitar impactos en los servicios</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>üìû Contacto</h4>
                    <p>soporte@pentestexpress.com</p>
                    <p>+34 123 456 789</p>
                </div>
                <div class="footer-section">
                    <h4>üåê Web</h4>
                    <p><a href="https://www.pentestexpress.com">www.pentestexpress.com</a></p>
                </div>
                <div class="footer-section">
                    <h4>üìÑ Confidencialidad</h4>
                    <p>Este informe es confidencial y est√° destinado √∫nicamente al destinatario autorizado.</p>
                </div>
            </div>
            <div class="text-center">
                <p>&copy; 2024 Pentest Express. Todos los derechos reservados.</p>
                <p>Informe generado autom√°ticamente el {{ date }}</p>
            </div>
        </div>
    </div>
</body>
</html>