<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Informe de seguridad – {{ domain }}</title>
  <style>
    @page { margin: 2cm 1.5cm; font-family: "Helvetica"; }
    h1   { font-size: 24px; margin-bottom: 0.2cm;  }
    h2   { font-size: 18px; margin-top: 1cm; color:#1a237e; }
    table{ width:100%; border-collapse:collapse; margin-top:0.4cm; }
    th,td{ border:1px solid #ddd; padding:5px; font-size:12px; }
    th   { background:#f0f2ff; }
    .sev-high   { background:#ffe5e5; }
    .sev-medium { background:#fff9e5; }
    .sev-low    { background:#e8ffe8; }
    .tiny {font-size:11px; color:#666;}
    footer {position:fixed; bottom:0; font-size:10px; text-align:right; width:100%;}
  </style>
</head>
<body>
<h1>Informe de Seguridad<br>{{ domain }}</h1>
<p class="tiny">Generado el {{ now }}</p>

<h2>Resumen</h2>
<ul>
  <li><strong>{{ summary.subdomains }} subdominios</strong> identificados.</li>
  <li><strong>{{ summary.vulns }} vulnerabilidades</strong> críticas/altas detectadas por Nuclei.</li>
  <li><strong>TLS:</strong> {{ summary.tls }}</li>
  <li><strong>Credenciales filtradas:</strong> {{ summary.leaks }}</li>
</ul>

<h2>Subdominios vivos</h2>
<table>
  <thead><tr><th>#</th><th>Host</th><th>Status</th><th>Tecnologías</th></tr></thead>
  <tbody>
  {% for s in subs %}
    <tr><td>{{ loop.index }}</td><td>{{ s.url }}</td><td>{{ s.status }}</td><td>{{ ", ".join(s.tech) }}</td></tr>
  {% endfor %}
  </tbody>
</table>

<h2>Vulnerabilidades (Nuclei)</h2>
<table>
  <thead><tr><th>#</th><th>Host</th><th>Plantilla</th><th>Severidad</th></tr></thead>
  <tbody>
  {% for v in vulns %}
    <tr class="sev-{{ v.severity }}">
      <td>{{ loop.index }}</td>
      <td>{{ v.host }}</td>
      <td>{{ v.template }}</td>
      <td>{{ v.severity|upper }}</td>
    </tr>
  {% else %}
    <tr><td colspan="4" style="text-align:center;">Sin hallazgos críticos/altos</td></tr>
  {% endfor %}
  </tbody>
</table>

<h2>Typosquatting relevantes</h2>
<ul>
  {% for d in typos[:10] %}
    <li>{{ d }}</li>
  {% else %}
    <li>Ninguno relevante</li>
  {% endfor %}
</ul>

<footer>Pentest Express · Informe generado automáticamente · Página {{ page_number }}</footer>
</body>
</html>