#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Paquete de configuración para el sistema de pentesting.
Contiene configuraciones para ML, detección mejorada y otros componentes.
"""

# Importaciones principales del paquete
try:
    from .ml_config import ML_CONFIG
except ImportError:
    ML_CONFIG = None

# Importar configuraciones principales desde el módulo config.py del directorio padre
try:
    from ..config import (
        REDIS_URL, SAFE_DOMAIN, DEFAULT_TIMEOUT, HTTP_REQUEST_TIMEOUT,
        HIBP_REQUEST_TIMEOUT, AMASS_TIMEOUT, WAF_EVASION_CONFIG,
        WAF_USER_AGENTS, WAF_COMMON_HEADERS, TEMPLATES_DIR, USER_AGENT,
        MAIL_SENDER_EMAIL, MAIL_SENDER_NAME, get_common_emails
    )
except ImportError:
    # Valores por defecto si no se pueden importar
    import os
    import re
    from pathlib import Path
    
    REDIS_URL = os.getenv("REDIS_URL", "redis://localhost:6379")
    SAFE_DOMAIN = re.compile(r"^[a-z0-9.-]{3,253}$", re.I)
    DEFAULT_TIMEOUT = 300
    HTTP_REQUEST_TIMEOUT = 10
    HIBP_REQUEST_TIMEOUT = 10
    AMASS_TIMEOUT = 600
    WAF_EVASION_CONFIG = {
        "max_requests_per_domain": 10,
        "request_delay_min": 1,
        "request_delay_max": 3,
        "connect_timeout": 10,
        "max_time": 20,
        "max_redirects": 3,
        "retry_attempts": 1,
        "retry_delay": 2,
    }
    WAF_USER_AGENTS = [
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
        "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
    ]
    WAF_COMMON_HEADERS = {
        "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8",
        "Accept-Language": "en-US,en;q=0.5",
        "Accept-Encoding": "gzip, deflate",
        "Cache-Control": "no-cache",
        "Pragma": "no-cache",
        "Upgrade-Insecure-Requests": "1"
    }
    TEMPLATES_DIR = Path(".")
    USER_AGENT = "PentestExpress/2.0"
    MAIL_SENDER_EMAIL = "informes@auditatetumismo.es"
    MAIL_SENDER_NAME = "Pentest Express"
    
    def get_common_emails(domain: str) -> list[str]:
        return [f"info@{domain}", f"contact@{domain}", f"admin@{domain}"]

__all__ = [
    'ML_CONFIG', 'REDIS_URL', 'SAFE_DOMAIN', 'DEFAULT_TIMEOUT',
    'HTTP_REQUEST_TIMEOUT', 'HIBP_REQUEST_TIMEOUT', 'AMASS_TIMEOUT',
    'WAF_EVASION_CONFIG', 'WAF_USER_AGENTS', 'WAF_COMMON_HEADERS',
    'TEMPLATES_DIR', 'USER_AGENT', 'MAIL_SENDER_EMAIL', 'MAIL_SENDER_NAME',
    'get_common_emails'
]